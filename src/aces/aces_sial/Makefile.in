#Compilers
FC=@FC@
CC=@CC@
CPP=@CXX@
SERIAL_CPP=@SERIAL_CPP@

#Compiler flags
FFLAGS=@FCFLAGS@
CFLAGS=@CFLAGS@
CPPFLAGS=@CXXFLAGS@

#ACESLIBS variable will be replaced by the autoconf script with appropriate libraries
LIBS = @ACESLIBS@
LIBS:= -lstdc++ -lsip1 -lsip2 -lsip_shared -lframelib -laces2 -lgeopt -lsymcor -laces2 -lerd -loed -ldup -lsip1 -lsip2 $(LIBS)

#ACESFLAGS variable will be replaced by the autoconf script with location of libraries
LIB_DIRS= @ACESFLAGS@

SIAL_COMPILER_LIBS= @SIAL_COMPILER_LIBS@


SIAL_COMPILER=../../../bin/sial
SIO_DIR=../../../bin/sio

SIAL_SOURCE := $(wildcard */*.sial)
SIAL_SOURCE += $(wildcard */*/*.sial)
SIAL_SOURCE += $(wildcard */*/*/*.sial)
SIAL_SOURCE += $(wildcard *.sial)
SIO_OBJS=$(SIAL_SOURCE:.sial=.sio)
LD_LIBRARY_PATH :=/opt/intel/mkl/11.1.064/lib/em64t:${LD_LIBRARY_PATH}
all: $(SIO_OBJS) $(SIO_DIR)/sial_config $(SIO_DIR)/default_jobflows

binclean clean distclean: % : ;
	find . -type f -name "*.sio" -exec rm -f '{}' \;

rebuild relink: % : binclean all

libclean ppclean archive: % : ;

$(SIO_DIR)/sial_config: sial_config
	cp sial_config $(SIO_DIR)

$(SIO_DIR)/default_jobflows: default_jobflows
	cp default_jobflows $(SIO_DIR)

.SUFFIXES: .sial .sio

.sial.sio:
	$(SIAL_COMPILER) $< && cp $@ $(SIO_DIR)
